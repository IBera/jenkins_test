

node('terraform'){

    /*parameters {
		string(name: 'AZURE_KEYVAULT_URL', description: 'Name of the image to build')
	}*/

    stage('test'){
        sh "terraform -version"
        sh "pwd"
        sh "ls -ll"
    }

    stage('Terraform Init'){        

        def secrets = [
            secret('BACKEND_STORAGE_ACCOUNT_NAME', 'BACKEND_STORAGE_ACCOUNT_NAME')
            secret('BACKEND_STORAGE_ACCOUNT_CONTAINER_NAME', 'BACKEND_STORAGE_ACCOUNT_CONTAINER_NAME')
            secret('RG_NAME', 'RG_NAME')
            secret('ARM_ACCESS_KEY', 'BACKEND-ACCESS-KEY')
        ]

        withAzureKeyvault(
            azureKeyVaultSecrets: secrets, 
            keyVaultURLOverride: 'https://kv-devopsigb-prod-france.vault.azure.net/',
            credentialIDOverride: 'azure_service_principal'
        ) {
            sh 'echo $BACKEND_STORAGE_ACCOUNT_NAME'
            sh 'echo $BACKEND_STORAGE_ACCOUNT_CONTAINER_NAME'
            sh 'echo $RG_NAME'
            sh 'echo $BACKEND-ACCESS-KEY'
        }

    }
}